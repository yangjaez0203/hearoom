openapi: 3.0.0
info:
  title: Hearoom API
  version: 1.0.0
servers:
  - url: https://localhost:8080 # TODO Update
tags:
  - name: system
    description: System related endpoints
  - name: users
    description: |
      유저 식별 및 인증 시스템.

      모든 요청(공개 엔드포인트 제외)에 Identity 미들웨어가 적용됩니다.
      `Authorization: Bearer <token>` 헤더의 JWT로 유저를 식별하며, 비회원과 회원 모두 동일한 형식을 사용합니다.

      ## 인증 흐름

      ```
      최초 방문 (토큰 없음)
        → 비회원 자동 생성 → 응답 X-Token 헤더로 JWT 발급
        → 클라이언트가 토큰 저장

      재방문 (토큰 있음)
        → Authorization: Bearer <token> 헤더에 포함
        → 유효하면 기존 유저로 식별
        → 만료/무효하면 새 비회원 재생성

      회원가입/로그인 (미구현)
        → 로그인 API에서 새 JWT 발급 (anonymous: false)
        → 기존 비회원 토큰을 새 토큰으로 교체
      ```

      ## JWT Claims

      | Claim | 비회원 | 회원 (미구현) |
      |-------|--------|---------------|
      | `sub` | UUID (자동 생성) | UUID (계정 ID) |
      | `username` | 랜덤 한글 닉네임 | 유저 설정값 |
      | `anonymous` | `true` | `false` |
      | `exp` | 만료 시간 | 만료 시간 |

      ## 비회원 유저 특징
      - UUID 기반 고유 ID 자동 부여
      - 랜덤 한글 닉네임 자동 생성 (예: `즐거운고양이42`)
      - `anonymous: true` 플래그
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Identity 미들웨어 또는 로그인 API(미구현)가 발급한 JWT 토큰.
        비회원·회원 모두 동일한 Bearer 형식을 사용합니다.
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: 유저 고유 식별자
          example: "550e8400-e29b-41d4-a716-446655440000"
        username:
          type: string
          description: 비회원은 랜덤 한글 닉네임 자동 생성, 회원은 유저 설정값
          example: "즐거운고양이42"
        anonymous:
          type: boolean
          description: 비회원이면 true, 회원이면 false
          example: true
      required:
        - id
        - username
        - anonymous
    Error:
      type: object
      properties:
        error:
          type: string
          description: 에러 메시지
          example: "failed to generate token"
paths:
  /health:
    get:
      $ref: './system/health.yaml'
  /me:
    get:
      $ref: './users/me.yaml'